I"Ü	<h3 id="å‰è¨€">å‰è¨€</h3>

<p>Androidå¼€å‘ä¸­ï¼Œç»å¸¸ä¼šå°†ä¸€äº›æ–‡ä»¶æ”¾åœ¨å†…éƒ¨ç›®å½•ä¸­ï¼Œä¹Ÿå³<code>/data/data/pacakge_id</code>ä¸­ï¼Œdbæ–‡ä»¶ä¹Ÿåœ¨è¯¥ç›®å½•ä¸­ ï¼Œåœ¨érootçš„æ‰‹æœºä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®<code> /data/data</code> ä¸‹çš„æ–‡ä»¶ï¼Œè°ƒè¯•èµ·æ¥éå¸¸çš„ä¸æ–¹ä¾¿ï¼Œè§£å†³çš„åŠæ³•æœ‰å‡ ç§ï¼š</p>

<ol>
  <li>
    <p>æ‰¾ä¸€å°rootçš„æ‰‹æœºï¼Œæƒ³çœ‹ä»€ä¹ˆçœ‹ä»€ä¹ˆ</p>
  </li>
  <li>
    <p>æ–­ç‚¹è°ƒè¯•ï¼Œå¯ä»¥ç¨å¾®éº»çƒ¦çš„çœ‹åˆ°æœ¬åº”ç”¨çš„ç›®å½•åŠæ–‡ä»¶</p>
  </li>
  <li>
    <p>run-aså‘½ä»¤</p>
  </li>
</ol>

<p>æœ¬æ–‡æ¥è®²è§£ä¸€ä¸‹<code>run-as</code>ã€‚</p>

<h3 id="run-as">run-as</h3>

<p><code>run-as</code> å‘½ä»¤æ¥è·å–debugåº”ç”¨çš„ç§æœ‰æ•°æ®ï¼Œåœ¨å¯¹debugåŒ…æµ‹è¯•çš„æ—¶å€™ï¼Œä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥åˆ‡æ¢ç”¨æˆ·åˆ°ç³»ç»Ÿåˆ†é…ç»™å¯¹åº”debugåº”ç”¨çš„uidï¼Œä¸‹é¢ä»¥æˆ‘çš„ä¸€ä¸ªæµ‹è¯•åº”ç”¨<code>me.codeboy.test</code> ä¸ºä¾‹çœ‹ä¸€ä¸‹:</p>

<pre><code class="language-shell">âœ ~ adb shell
chiron:/ $ whoami
shell

chiron:/ $ ls /data/data/me.codeboy.test
ls: /data/data/me.codeboy.test: Permission denied

1|chiron:/ $ run-as me.codeboy.test
chiron:/data/data/me.codeboy.test $ ls
cache code_cache shared_prefs 

chiron:/data/data/me.codeboy.test $ whoami
u0_a279
</code></pre>

<p>å¯ä»¥çœ‹å‡ºåœ¨é»˜è®¤çš„shellç¯å¢ƒä¸‹ï¼Œç”¨æˆ·èº«ä»½æ˜¯<code>shell</code>ï¼Œæ— æ³•æŸ¥çœ‹åº”ç”¨çš„ç§æœ‰æ•°æ®ï¼Œè¿è¡Œ <code>run-as</code> åï¼Œèº«ä»½åˆ‡æ¢äº† <code>u0_a279</code>, è¿™ä¸ªç”¨æˆ·å…¶å®æ˜¯æµ‹è¯•åº”ç”¨çš„uidï¼Œæ‰€ä»¥å¯ä»¥è‡ªç”±çš„è®¿é—®å…¶ç§æœ‰ç›®å½•ã€‚</p>

<p>Androidä¸­ä¸€ä¸ªåº”ç”¨æœ‰ä¸€ä¸ªuidï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸‹æ–¹å¼è·å–:</p>

<pre><code class="language-java">try {
  		PackageManager pm = getPackageManager();
  		ApplicationInfo ai = pm.getApplicationInfo("me.codeboy.test", 0);
  		Toast.makeText(MainActivity.this, Integer.toString(ai.uid,10), Toast.LENGTH_SHORT).show();
    } catch (PackageManager.NameNotFoundException e) {
}
</code></pre>

<p>æ‰§è¡Œåï¼Œè¾“å‡ºçš„ç»“æœæ˜¯10279ã€‚</p>

<p>æ¯ä¸ªAndroidåº”ç”¨ç¨‹åºçš„u0_axxxéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼ŒåŒæ—¶UIDæ˜¯ä»10000å¼€å§‹ï¼Œu0_aåé¢çš„æ•°å­—åŠ ä¸Š10000æ‰€å¾—çš„å€¼ï¼Œæ—¢æ˜¯UIDï¼Œè¿™ä¸ªå’Œæµ‹è¯•åº”ç”¨çš„è¾“å‡ºä¹Ÿéå¸¸çš„å»åˆï¼Œ<code>u0_a279</code> å’Œ <code>10279</code>ã€‚</p>

<h3 id="å°ç»“">å°ç»“</h3>

<p><code>run-as</code> è®©å¯ä»¥åœ¨érootçš„æ‰‹æœºä¸ŠæŸ¥çœ‹åº”ç”¨çš„ç§æœ‰ç›®å½•ï¼Œå¯¹å¼€å‘è°ƒè¯•æ¥è¯´éå¸¸çš„æ–¹ä¾¿ã€‚</p>

<blockquote>
  <p>å¦‚æœ‰ä»»ä½•çŸ¥è¯†äº§æƒã€ç‰ˆæƒé—®é¢˜æˆ–ç†è®ºé”™è¯¯ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚</p>

  <p>è½¬è½½è¯·æ³¨æ˜åŸä½œè€…åŠä»¥ä¸Šä¿¡æ¯ã€‚</p>
</blockquote>
:ET