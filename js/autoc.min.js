"use strict";function _instanceof(b,a){if(a!=null&&typeof Symbol!=="undefined"&&a[Symbol.hasInstance]){return a[Symbol.hasInstance](b)}else{return b instanceof a}}function _classCallCheck(a,b){if(!_instanceof(a,b)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(d,b){for(var a=0;a<b.length;a++){var c=b[a];c.enumerable=c.enumerable||false;c.configurable=true;if("value" in c){c.writable=true}Object.defineProperty(d,c.key,c)}}function _createClass(c,a,b){if(a){_defineProperties(c.prototype,a)}if(b){_defineProperties(c,b)}return c}var AutocJs=function(){function h(G){_classCallCheck(this,h);this.attributes={};this.elements={article:null,wrap:null,modal:null,header:null,title:null,body:null,list:null,footer:null,switcher:null,top:null,overlay:null,anchors:[]};this.data={headings:[],chapters:[]};this.timer=null;this.initialize(G).render().addListeners();return this}_createClass(h,[{key:"initialize",value:function b(G){var I=this.getElements();var H=this.getData();var J;var K;this.set(h.defaults).set(G);J=document.querySelector(this.get("article"));K=this.generateHeadings(J.querySelectorAll(this.get("selector")));I.article=J;H.headings=K;H.chapters=this.generateChapters(K);return this}},{key:"reload",value:function s(G){this.destroy().initialize(G).render().addListeners();return this}},{key:"set",value:function n(J,I){var G=h.Utils;var H=this.attributes;if(arguments.length===2){H[J]=I}else{if(G.isObject(J)){G.extend(H,J)}}return this}},{key:"get",value:function z(G){return this.attributes[G]}},{key:"getElements",value:function l(){return this.elements}},{key:"getData",value:function m(){return this.data}},{key:"generateHeadings",value:function y(H){var I=[];var G=h.Utils;Array.prototype.forEach.call(H,function(J){I.push({id:G.guid("outline-heading"),node:J,tagName:J.tagName,level:parseInt(J.tagName.replace(/[h]/i,""),10)})});return I}},{key:"generateChapters",value:function a(K){var H=h.Utils;var J=[];var I=1;var L=0;var G=-1;K.forEach(function(P,N){var O=P.level;var M=-1;if(O>I){L+=1;if(L===1){M=-1}else{M=N-1}G=I}else{if(O===I||O<I&&O>L){if(O===1){L=1;M=-1}else{M=J[N-1].pid}if(O<I&&O===G){L=L-1;if(L===1){M=-1}else{M=M-1}}}else{if(O<=L){if(O===1){L=1}else{L=L-(I-O);if(L<=1){L=1}}if(L===1){M=-1}else{M=h._generatePid(J,I-O,N)}}}}I=O;J.push({id:N,pid:M,level:L,rel:P.id,text:H.stripTags(H.trim(P.node.innerHTML))})});this.generateChapterCode(J);return J}},{key:"generateChapterCode",value:function g(I){var H=h.Utils;var G=H.groupBy(I,"pid");G.forEach(function(J){J.forEach(function(K,L){K.index=L+1})});G.forEach(function(J){J.forEach(function(K){I.forEach(function(L){if(L.pid===-1){L.code=String(L.index)}else{if(L.pid===K.id){L.code=K.code+"."+L.index}}})})});return this}},{key:"render",value:function F(){this.renderAnchors().renderOutline();return this}},{key:"renderAnchors",value:function u(){var M=this;var L=h.Utils.DOM;var I=this.getData();var K=I.headings;var G=I.chapters;var H=this.getElements();var J=this.get("anchorURL");K.forEach(function(U,Q){var S=U.node;var R=L.createElement("i",{className:"icon icon-section outline-heading-icon"});var P=J?J:"#"+U.id;var N=M.get("anchorAt")==="front"?"outline-heading-anchor-at-front":"outline-heading-anchor-at-end";var O=L.createElement("a",{"aria-hidden":true,className:"outline-heading-anchor "+N+" outline-link outline-hidden",rel:U.id,href:P},[R]);var T;L.addClass(S,"outline-heading");S.id=U.id;if(M.get("isGenerateHeadingChapterCode")){T=L.createElement("span",{className:"outline-heading-code"},[G[Q].code]);S.insertBefore(T,S.firstChild)}if(M.get("isGenerateHeadingAnchor")){S.appendChild(O);H.anchors.push(O)}});return this}},{key:"renderOutline",value:function j(){var G=this.get("position").toLowerCase();if(!this.get("isGenerateOutline")){return this}switch(G){case"outside":this.renderOutsideOutline();break;case"inside":this.renderInsideOutline();break}this.renderChapters();return this}},{key:"renderOutsideOutline",value:function E(){var G=h.Utils;var J=G.DOM;var H=this.getElements();var I=this.get("title");H.title=J.createElement("h2",{className:"outline-outside-title"},[I]);H.header=J.createElement("div",{className:"outline-outside-header"},[H.title]);H.list=J.createElement("ul",{className:"outline-outside-list"});H.body=J.createElement("div",{className:"outline-outside-body"},[H.list]);H.switcher=J.createElement("div",{className:"outline-outside-button outline-outside-switcher"},[J.createElement("i",{className:"icon icon-menu"})]);H.top=J.createElement("div",{className:"outline-outside-button outline-outside-top"},[J.createElement("a",{href:"#top",className:"outline-outside-top"},[J.createElement("i",{className:"icon icon-arrow-up"})])]);H.footer=J.createElement("div",{className:"outline-outside-footer",id:"cb-menu"},[H.switcher,H.top]);H.modal=J.createElement("div",{className:"outline-outside-modal"},[H.header,H.body,H.footer]);H.overlay=J.createElement("div",{className:"outline-outside-overlay outline-hidden"});H.wrap=J.createElement("div",{className:"outline-outside"},[H.modal,H.overlay]);document.body.appendChild(H.wrap);return this}},{key:"renderInsideOutline",value:function e(){var G=h.Utils;var J=G.DOM;var H=this.getElements();var I=this.get("title");H.title=J.createElement("h2",{className:"outline-inside-title"},[I]);H.header=J.createElement("div",{className:"outline-inside-header"},[H.title]);H.list=J.createElement("ul",{className:"outline-inside-list"});H.body=J.createElement("div",{className:"outline-inside-body"},[H.list]);H.wrap=J.createElement("div",{className:"outline-inside"},[H.header,H.body]);H.article.insertBefore(H.wrap,H.article.firstChild);return this}},{key:"renderChapters",value:function p(){var H=this;var G=this.getData().chapters;var J=h.Utils.DOM;var I=this.getElements().list;G.forEach(function(L){var N=L.pid;var Q;var O;var R;var K;var S=J.createElement("span",{className:"outline-chapter-text"},[L.text]);var P=J.createElement("a",{className:"outline-link",href:"#"+L.rel,rel:L.rel},[S]);var M=[];if(H.get("isGenerateOutlineChapterCode")){K=J.createElement("span",{className:"outline-chapter-code"},[L.code]);M.push(K)}M.push(P);R=J.createElement("li",{id:"outline-chapter-"+L.id,className:"outline-chapter"},M);if(N===-1){I.appendChild(R)}else{Q=document.getElementById("outline-chapter-"+N);O=document.getElementById("outline-subject-"+N);if(!O){O=J.createElement("ul",{id:"outline-subject-"+N,className:"outline-subject"},[R]);Q.appendChild(O)}else{O.appendChild(R)}}});return this}},{key:"scrollTo",value:function d(M){var L=this;var O=h.Utils;var G=document.querySelectorAll("html,body");var H=G[0].scrollTop-G[1].scrollTop>=0?G[0]:G[1];var I=H.scrollTop;var Q=M-H.scrollTop<0;var J=H.scrollHeight-window.innerHeight;var P=M-J<=0?M:J;var R=30;var K=0;var N=function N(){if(L.timer){L.stop()}K+=1;if(Q){I-=O.easeInQuad(K);H.scrollTop=I;if(H.scrollTop<=M){H.scrollTop=M;L.stop();return false}}else{I+=O.easeInQuad(K);H.scrollTop=I;if(H.scrollTop>=P){H.scrollTop=P;L.stop();return false}}L.timer=setTimeout(N,R)};N();return this}},{key:"stop",value:function r(){clearTimeout(this.timer);this.timer=null;return this}},{key:"show",value:function B(){var G=this.getElements();var H=h.Utils.DOM;H.addClass(G.modal,"outline-outside-modal-opened");H.removeClass(G.overlay,"outline-hidden");return this}},{key:"hide",value:function k(){var G=this.getElements();var H=h.Utils.DOM;H.removeClass(G.modal,"outline-outside-modal-opened");H.addClass(G.overlay,"outline-hidden");return this}},{key:"toggle",value:function q(){if(h.Utils.DOM.hasClass(this.getElements().modal,"outline-outside-modal-opened")){this.hide()}else{this.show()}return this}},{key:"remove",value:function D(){var H=this.getElements();var G=H.wrap;this.removeListeners();if(this.get("isGenerateHeadingAnchor")){H.anchors.forEach(function(I){I.parentNode.removeChild(I)})}G.parentNode.removeChild(G);return this}},{key:"destroy",value:function A(){this.remove();this.attributes={};this.elements={article:null,wrap:null,modal:null,header:null,title:null,body:null,list:null,footer:null,switcher:null,top:null,overlay:null,anchors:[]};this.data={headings:[],chapters:[]};this.timer=null;return this}},{key:"removeListeners",value:function x(){var J=this.getElements();var K=J.article;var I=J.wrap;var H=h.Utils;var L=H.Events.off;var G=this.get("position").toLowerCase();L(K,"mouseenter",this._handleArticleHeadingMouseEnter);L(K,"mouseleave",this._handleArticleHeadingMouseLeave);if(G==="outside"){L(I,"click",this._handleSwitcherClick);L(I,"click",this._handleTopClick);L(I,"click",this._handleOverlayClick)}L(I,"click",this._handleChapterClick);if(this.get("isGenerateHeadingAnchor")){L(K,"click",this._handleHeadingAnchorClick)}return this}},{key:"addListeners",value:function o(){var L=this.getElements();var M=L.article;var K=L.wrap;var H=h.Utils;var I=H.Events;var J=I.delegate;var G=this.get("position").toLowerCase();J(M,".outline-heading","mouseenter",this._handleArticleHeadingMouseEnter,this);J(M,".outline-heading","mouseleave",this._handleArticleHeadingMouseLeave,this);if(G==="outside"){J(K,".outline-outside-switcher","click",this._handleSwitcherClick,this);J(K,".outline-outside-top","click",this._handleTopClick,this);J(K,".outline-outside-overlay","click",this._handleOverlayClick,this)}J(K,".outline-link","click",this._handleChapterClick,this);if(this.get("isGenerateHeadingAnchor")){J(M,".outline-heading-anchor","click",this._handleHeadingAnchorClick,this)}return this}},{key:"_handleArticleHeadingMouseEnter",value:function f(G){var I=G.delegateTarget;var H=I.querySelector(".outline-heading-anchor");if(H){h.Utils.DOM.removeClass(H,"outline-hidden")}return this}},{key:"_handleArticleHeadingMouseLeave",value:function w(G){var I=G.delegateTarget;var H=I.querySelector(".outline-heading-anchor");if(H){h.Utils.DOM.addClass(H,"outline-hidden")}return this}},{key:"_handleHeadingAnchorClick",value:function c(I){var J=I.delegateTarget;var G=J.getAttribute("rel");var M=document.querySelector("#"+G);var H=h.Utils;var N=H.DOM;var K=H.Events;var L=N.offset(M).top;if(H.isEmpty(this.get("anchorURL"))){this.stop().scrollTo(L);K.stop(I)}return this}},{key:"_handleChapterClick",value:function C(I){var J=I.delegateTarget;var G=J.getAttribute("rel");var M=document.querySelector("#"+G);var H=h.Utils;var N=H.DOM;var K=H.Events;var L=N.offset(M).top;if(this.get("position")==="outside"){this.hide()}this.stop().scrollTo(L);K.stop(I);return this}},{key:"_handleSwitcherClick",value:function t(){this.toggle();return this}},{key:"_handleTopClick",value:function i(H){var G=h.Utils;var I=G.Events;this.stop().scrollTo(0);I.stop(H);return this}},{key:"_handleOverlayClick",value:function v(){this.hide();return this}}]);return h}();AutocJs.defaults={article:"#article",selector:"h1,h2,h3,h4,h5,h6",title:"文章导读",position:"outside",anchorURL:"",anchorAt:"front",isGenerateOutline:true,isGenerateOutlineChapterCode:true,isGenerateHeadingChapterCode:false,isGenerateHeadingAnchor:true};AutocJs.Utils={uuid:0,isObject:function isObject(a){return Object.prototype.toString.apply(a)==="[object Object]"&&a!==null},isArray:function isArray(a){if(Array.isArray){return Array.isArray(a)}else{return Object.prototype.toString.apply(a)==="[object Array]"}},isElement:function isElement(a){return a&&a.nodeName&&a.tagName&&a.nodeType===1},isEmpty:function isEmpty(a){return typeof a==="string"&&a===""},guid:function guid(b){var a=AutocJs.Utils;a.uuid+=1;return b?b+"-"+a.uuid:"guid-"+a.uuid},trim:function trim(a){return a.replace(/^\s+/g,"").replace(/\s+$/g,"")},stripTags:function stripTags(a){return a.replace(/<\/?[^>]+(>|$)/g,"")},groupBy:function groupBy(c,d){var b={};var a=function a(e){return[e[d]]};c.forEach(function(f){var e=JSON.stringify(a(f));b[e]=b[e]||[];b[e].push(f)});return Object.keys(b).map(function(e){return b[e]})},easeInQuad:function easeInQuad(a){return a*a},extend:function extend(a,b){for(var c in b){if(b.hasOwnProperty(c)){a[c]=b[c]}}}};AutocJs.Utils.DOM={createElement:function createElement(f,c,e){var b=AutocJs.Utils;var g=b.DOM;var d=document.createElement(f);for(var a in c){if(c.hasOwnProperty(a)){g.setAttribute(d,a,c[a])}}if(b.isArray(e)){e.forEach(function(i){var h=b.isElement(i)?i:document.createTextNode(i);d.appendChild(h)})}return d},setAttribute:function setAttribute(c,a,d){var b=c.tagName.toLowerCase();switch(a){case"style":c.style.cssText=d;break;case"value":if(b==="input"||b==="textarea"){c.value=d}else{c.setAttribute(a,d)}break;case"className":c.className=d;break;default:c.setAttribute(a,d);break}},hasClass:function hasClass(b,a){var c=b.className;if(!c){return false}return c.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))},addClass:function addClass(b,a){var c=b.className;if(AutocJs.Utils.DOM.hasClass(b,a)){return false}c+=c.length>0?" "+a:a;b.className=c},removeClass:function removeClass(c,b){var a=AutocJs.Utils;var d=c.className;if(!d||!a.DOM.hasClass(c,b)){return false}d=a.trim(d.replace(b,""));c.className=d},offset:function offset(a){var d=AutocJs.Utils.DOM;var c=d.offsetLeft(a);var b=d.offsetTop(a);return{left:c,top:b}},offsetTop:function offsetTop(a){var c=AutocJs.Utils.DOM;var b=a.offsetTop;if(a.offsetParent!==null){b+=c.offsetTop(a.offsetParent)}return b},offsetLeft:function offsetLeft(a){var c=AutocJs.Utils.DOM;var b=a.offsetLeft;if(a.offsetParent!==null){b+=c.offsetLeft(a.offsetParent)}return b}};AutocJs.Utils.Events={delegate:function delegate(e,a,d,g,c,b){var f=function f(h){if(h.delegateTarget=AutocJs.getDelegateTarget(e,h.target,a)){g.call(c||e,h)}};if(d==="mouseenter"||d==="mouseleave"){b=true}g._delegateWrapper=g;e.addEventListener(d,f,b||false)},off:function off(c,b,d,a){if(d._delegateWrapper){d=d._delegateWrapper;delete d._delegateWrapper}if(b==="mouseenter"||b==="mouseleave"){a=true}c.removeEventListener(b,d,a||false)},stop:function stop(a){var b=AutocJs.Utils.Events;b.stopPropagation(a);b.preventDefault(a)},stopPropagation:function stopPropagation(a){var b=window.event;if(a.stopPropagation){a.stopPropagation()}else{b.cancelBubble=true}},preventDefault:function preventDefault(a){var b=window.event;if(a.preventDefault){a.preventDefault()}else{b.returnValue=false}}};AutocJs.getDelegateTarget=function(b,c,a){while(c&&c!==b){if(AutocJs.Utils.DOM.hasClass(c,a.replace(".",""))){return c}c=c.parentElement}return null};AutocJs._generatePid=function(d,c,b){var a;switch(c){case 2:a=d[d[d[b-1].pid].pid].pid;break;case 3:a=d[d[d[d[b-1].pid].pid].pid].pid;break;case 4:a=d[d[d[d[d[b-1].pid].pid].pid].pid].pid;break;case 5:a=d[d[d[d[d[d[b-1].pid].pid].pid].pid].pid].pid;break;default:a=d[d[b-1].pid].pid;break}return a};if(window.jQuery){$.extend($.fn,{articleOutline:function articleOutline(a){var b=$(this);return new AutocJs($.extend({},a,{article:b}))}})};